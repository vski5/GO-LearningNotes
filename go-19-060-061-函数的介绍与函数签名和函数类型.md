# go-19-060-061-函数的介绍与函数签名和函数类型

函数是最基本的代码块，每个程序包含很多函数。

对于编译型语言，函数编写的顺序不做要求，但为了可读性，一般会按被调用的顺序写，就像是先写:

```
package main
import "fmt"
func main(){

}
```

函数编写不需要顺序,函数只用出现一次，整个程序中可以调用这个函数，所以有一个原则诞生：DRY，也就是不重复你自己。

在代码块的执行中：会执行函数（因为函数是最基本的代码块），执行到最后一个`}`或者满足`return`这类退出语句的时候，停止继续执行。

Go 里面有三种类型的函数：  

- 普通的带有名字的函数
- 匿名函数或者lambda函数（参考第 6.8 节）
- 方法（Methods，参考第 10.6 节）

除了main()、init()函数外，其它所有类型的函数都可以有参数与返回值。

函数参数、返回值以及它们的类型被统称为函数签名。

函数签名——可用来概括三类：

1. 函数参数
2. 返回值
3. 以及它们的类型



一个格式的要求：

```go
func g() {
}
```

被调用的基本格式：

```go
pack1.Function(arg1, arg2, …, argn)
```

翻译成中文就是：

```
包的名字.调用的函数名字（字符串变量名1，字符串变量名2）
```

`Function` 是 `pack1` 包里面的一个函数

args是arguments的缩写，意为 ：实参（argument），是指字符串变量名，属于引用变量

实参 传递给 被调用函数的 形参，也就是说，函数被调用时，实参会被复制然后传递给调用函数。

函数一般在其他函数里面被调用，其他函数 也就被称为 调用函数。

## 函数能多次调用其他函数，被调用函数按顺序执行。

一个例子：

```go
package main

func main() {
    println("In main before calling greeting")//这里用了三次println()
    greeting()
    println("In main after calling greeting")
}

func greeting() { //这里用了两次greeting()
    println("In greeting: Hi!!!!!")
}
```

函数可以调用其他函数作为他的参数，但被调用函数，（也就是此时作为参数的其他函数），要满足三个“一致”：

 1. 被调用函数的返回值个数

 2. 返回值类型

 3. 返回值的顺序 和 调用函数所需求的实参 是一致的。

    就是说，返回值的顺序 也就是 参数的顺序，参数的顺序 也就是 不同数据的顺序，如果这些数据的类型不同，因为这些数据的类型需要满足不同位置的实参的类型，

    所以按顺序将返回值的特征与实参所需的条件一一对应。

    假设 f1 需要 3 个参数 `f1(a, b, c int)`，同时 f2 返回 3 个参数 `f2(a, b int) (int, int, int)`，就可以这样调用 f1：`f1(f2(a, b))`。



### 函数重载（function overloading）：

指的是，在不同函数有不同的形参（或者返回值）的条件下，不同函数的名字可以相同，*<u>**但是golang里面这种操作是不允许的**</u>*。

函数重载需要进行多余的类型匹配影响性能，没有重载可以提升性能。



## 函数声明

函数声明包括

1. 函数名

2. 形式参数列表：

   描述函数的参数名 与 参数类型

   由 参数调用者提供（正在编程的你）

3. 返回值列表（可以省略）

   描述函数的返回值 的 变量名 以及 类型

   返回无名变量或者无返回值则 (result-list) 可以省略不写

   <u>***如果不声明返回值列表  则函数体执行完毕后不返回任何值***</u>

4. 函数体

函数体的格式为：

```go
func name(parameter-list) (result-list) {
    body
}
```

翻译成中文就是

```go
func 函数名（形式参数列表）（返回值列表）{
	函数体
}
```



这四个要求的更详细的格式见下面的**函数字面格式**



## 函数字面格式

下面是一个函数类型的字面形式:

<u>***第一个括号是输入的参数（参数列表），第二个括号是返回的结果（结果列表）***</u>

```go
func (a int, b string, c string) (x int, y int, z bool)
```

连续的同类型参数和结果可以声明在一块儿。 所以上面的字面形式等价于：

```go
func (a int, b, c string) (x, y int, z bool)
```

参数名称和结果名称并不重要，只要它们不重名即可。上面两个字面形式等价于下面这个：

```go
func (x int, y, z string) (a, b int, c bool)
```

参数名和结果名可以是空标识符`_`。上面的字面形式等价于：

```go
func (_ int, _, _ string) (_, _ int, _ bool)
```

函数参数列表中的参数名或者结果列表中的结果名可以同时省略（即匿名）。上面的字面形式等价于：

```go
func (int, string, string) (int, int, bool) // 标准函数字面形式
func (a int, b string, c string) (int, int, bool)
func (x int, _ string, z string) (int, int, bool)
func (int, string, string) (x int, y int, z bool)
func (int, string, string) (a int, b int, _ bool)
```

所有上面列出的函数类型字面形式表示同一个（非定义）函数类型。



**<u>*参数列表必须用一对小括号`()`括起来，即使此列表为空。*</u>**

就像是`func()`



对于**结果列表**而言的<u>***纸面格式***</u>：

	1. 单个返回值可以只写返回值的类型，可以不写括号。
	2. 结果列表为空时，可以只写个()，或者连()都不写。

```go
// 这三个函数类型字面形式是等价的。
func () (x int)
func () (int)
func () int

// 这两个函数类型字面形式是等价的。
func (a int, b string) ()
func (a int, b string)
```

## 形参 与 实参

### 对于形参而言

上面提到了形参，也就是由函数调用者提供的参数，在函数体中，形参只是函数最外层的局部变量，（有名返回值也一样），被储存在相同的词法块中。

更重要的是：**形参是实参的拷贝**，这一点在文中提过。

### 对于实参而言：

每一次函数调用，都需要按声明顺序为所有参数提供实参（参数值）,

GO没有默认参数值，也不能用参数名字指定形参，所以变量名字不影响参数的值。

**形参以值的方式传递**，**形参是实参的拷贝**

一般修改形参不影响实参，但如果实参引用了指针之类的类型，就有可能被修改



## 声明一个在外部定义的函数，

只需要函数名和函数签名，不需要给出函数体：

```go
func flushICache(begin, end uintptr) // implemented externally（外部实现）
```

### ***<u>函数签名</u>***：

相同条件必须函数的函数名，参数和返回值(类型，个数，顺序)都相同。**<u>*（稍后会讲函数签名和函数类型）*</u>**

flushICache：flush（清除） cache（缓存）的意思是清除cache中存储的全部数据。

uintptr：golang的内置类型，是能存储指针的整型，uintptr的底层类型是int，它和unsafe.Pointer可相互转换。

### 没有函数体的函数声明：

就是没{}

表示这个函数不是以GO语言实现的，这样的声明定义函数签名。



**函数也可以以申明的方式被使用，作为一个函数类型**，就像：

```go
type binOp func(int, int) int
```

在这里，不需要函数体 `{}`。

函数是一等值（first-class value）：它们可以赋值给变量，举个例子：

```
A := bin0p
```

这个变量知道自己指向的函数的签名，所以只能为一个变量赋值一个函数值。



函数值之间可以比较，如果变量引用的是相同的函数或者都是nil（也就是空值）的话，这些变量会被认为是相同的函数。

函数不能在其他函数里面声明，也就是不支持嵌套结构。（但可以用匿名函数突破限制见原书6.8）。

在非常注意性能的的场合，最好是为每一个类型单独创建一个函数，而且代码可读性更强。

## 函数签名（function signature）和函数类型

函数是一等值（first-class value），也被称作一等公民类型。

函数类型的纸面格式是：

```
func 函数签名（函数签名=输入参数类型列表+输出结果类型列表） 
```

参数和结果的名字可以出现在纸面中，这只是无关紧要的直面格式表示方法。

`func`关键字可以出现在函数签名的字面形式中，也可以不出现。 鉴于此，我们常常混淆使用函数类型（见下）和函数签名这两个概念。

